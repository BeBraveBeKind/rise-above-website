<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exit Intent Popup Test - Rise Above Partners</title>
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600&display=swap" rel="stylesheet">
  
  <!-- Base styles for testing -->
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      padding: 40px;
      min-height: 200vh; /* Make page scrollable for testing */
      background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
    }
    
    .test-container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 40px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    h1 {
      color: #333;
      margin-bottom: 30px;
    }
    
    .test-section {
      margin: 30px 0;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 4px;
    }
    
    .test-controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin: 20px 0;
    }
    
    button {
      padding: 10px 20px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-family: 'Montserrat', sans-serif;
      font-size: 14px;
    }
    
    button:hover {
      background: #0056b3;
    }
    
    button.secondary {
      background: #6c757d;
    }
    
    button.secondary:hover {
      background: #5a6268;
    }
    
    .status {
      padding: 10px;
      background: #d1ecf1;
      border: 1px solid #bee5eb;
      border-radius: 4px;
      color: #0c5460;
      margin: 10px 0;
    }
    
    .instructions {
      background: #fff3cd;
      padding: 15px;
      border-radius: 4px;
      margin: 20px 0;
    }
    
    code {
      background: #f8f9fa;
      padding: 2px 5px;
      border-radius: 3px;
    }
    
    .implementation-choice {
      display: flex;
      gap: 20px;
      margin: 20px 0;
    }
    
    .choice-card {
      flex: 1;
      padding: 20px;
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      cursor: pointer;
    }
    
    .choice-card:hover {
      border-color: #007bff;
    }
    
    .choice-card.active {
      border-color: #007bff;
      background: #f0f8ff;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>üß™ Exit Intent Popup Test Page</h1>
    
    <div class="instructions">
      <strong>‚ö° Quick Test Instructions:</strong>
      <ol>
        <li>Choose an implementation method below</li>
        <li>Scroll down at least 35% of the page</li>
        <li>Wait 15-20 seconds for qualification</li>
        <li>Move your mouse quickly toward the browser tab area (exit intent)</li>
        <li>Or use the manual trigger buttons below</li>
      </ol>
    </div>
    
    <div class="test-section">
      <h2>Choose Implementation:</h2>
      <div class="implementation-choice">
        <div class="choice-card" id="custom-impl">
          <h3>üõ†Ô∏è Custom Implementation</h3>
          <p>Full control over design and behavior</p>
          <ul>
            <li>Custom styling</li>
            <li>Advanced tracking</li>
            <li>Embedded Tally form</li>
            <li>More configuration options</li>
          </ul>
        </div>
        
        <div class="choice-card" id="tally-native">
          <h3>üì¶ Tally Native Exit</h3>
          <p>Quick setup with Tally's built-in popup</p>
          <ul>
            <li>Tally's default design</li>
            <li>Built-in exit detection</li>
            <li>Less code required</li>
            <li>Auto-handles mobile</li>
          </ul>
        </div>
      </div>
      
      <button onclick="loadImplementation('custom')">Load Custom Implementation</button>
      <button onclick="loadImplementation('tally')" class="secondary">Load Tally Native</button>
    </div>
    
    <div class="test-section">
      <h2>Test Controls (Custom Implementation Only):</h2>
      <div class="test-controls">
        <button onclick="testShow()">üöÄ Show Popup Now</button>
        <button onclick="testReset()" class="secondary">üîÑ Reset Cookie</button>
        <button onclick="testDebug()" class="secondary">üêõ Enable Debug Mode</button>
        <button onclick="checkStatus()">üìä Check Status</button>
      </div>
      
      <div id="status" class="status">
        Implementation not loaded yet. Choose one above.
      </div>
    </div>
    
    <div class="test-section">
      <h2>Scroll Test Area</h2>
      <p>This page is extra tall to test scroll-based triggers.</p>
      <p>Current scroll depth: <span id="scroll-percent">0</span>%</p>
      <p>Time on page: <span id="time-on-page">0</span> seconds</p>
      
      <div style="height: 500px; background: linear-gradient(180deg, #e9ecef 0%, #dee2e6 100%); margin: 20px 0; padding: 20px; border-radius: 4px;">
        <p>Scroll down to trigger scroll depth tracking...</p>
      </div>
    </div>
    
    <div class="test-section">
      <h2>Test Results:</h2>
      <div id="test-results">
        <p>Popup events will be logged here...</p>
      </div>
    </div>
  </div>
  
  <!-- Google Analytics (for testing event tracking) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QJNRR6GPV8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-QJNRR6GPV8');
  </script>
  
  <!-- Test Helper Scripts -->
  <script>
    let currentImplementation = null;
    let timeOnPage = 0;
    
    // Track time on page
    setInterval(() => {
      timeOnPage++;
      document.getElementById('time-on-page').textContent = timeOnPage;
    }, 1000);
    
    // Track scroll depth
    window.addEventListener('scroll', () => {
      const scrollPercent = Math.round((window.scrollY + window.innerHeight) / document.documentElement.scrollHeight * 100);
      document.getElementById('scroll-percent').textContent = scrollPercent;
    });
    
    // Implementation loader
    function loadImplementation(type) {
      // Remove any existing scripts
      const existingScript = document.getElementById('exit-intent-script');
      if (existingScript) {
        existingScript.remove();
      }
      
      // Clear any existing popups
      if (window.exitIntentPopup) {
        window.exitIntentPopup.hide();
      }
      
      // Update UI
      document.querySelectorAll('.choice-card').forEach(card => card.classList.remove('active'));
      
      const script = document.createElement('script');
      script.id = 'exit-intent-script';
      
      if (type === 'custom') {
        script.src = 'js/exit-intent-popup.js';
        document.getElementById('custom-impl').classList.add('active');
        currentImplementation = 'custom';
        updateStatus('Custom implementation loaded. Debug mode enabled for testing.');
        
        script.onload = () => {
          // Enable debug mode for testing
          if (window.exitIntentPopup) {
            window.exitIntentPopup.config.debugMode = true;
            window.exitIntentPopup.config.minTimeOnPage = 5000; // 5 seconds for testing
            window.exitIntentPopup.config.minScrollDepth = 20; // 20% for testing
          }
        };
      } else {
        script.src = 'js/tally-native-exit.js';
        document.getElementById('tally-native').classList.add('active');
        currentImplementation = 'tally';
        updateStatus('Tally native implementation loaded.');
        
        // Load Tally embed script
        const tallyScript = document.createElement('script');
        tallyScript.async = true;
        tallyScript.src = 'https://tally.so/widgets/embed.js';
        document.head.appendChild(tallyScript);
      }
      
      document.head.appendChild(script);
      logResult('Implementation loaded: ' + type);
    }
    
    // Test functions for custom implementation
    function testShow() {
      if (window.exitIntentPopup) {
        window.exitIntentPopup.show();
        logResult('Manual trigger: Popup shown');
      } else {
        alert('Load custom implementation first');
      }
    }
    
    function testReset() {
      if (window.exitIntentPopup) {
        window.exitIntentPopup.reset();
        logResult('Cookie reset - popup can show again');
        updateStatus('Cookie cleared. Popup will show on next trigger.');
      } else {
        alert('Load custom implementation first');
      }
    }
    
    function testDebug() {
      if (window.exitIntentPopup) {
        window.exitIntentPopup.config.debugMode = !window.exitIntentPopup.config.debugMode;
        const status = window.exitIntentPopup.config.debugMode ? 'enabled' : 'disabled';
        logResult('Debug mode ' + status);
        updateStatus('Debug mode ' + status + '. Check browser console for logs.');
      } else {
        alert('Load custom implementation first');
      }
    }
    
    function checkStatus() {
      if (window.exitIntentPopup) {
        const state = window.exitIntentPopup.state;
        const config = window.exitIntentPopup.config;
        updateStatus(`
          Qualified: ${state.qualifiedToShow ? 'Yes ‚úÖ' : 'No ‚ùå'}<br>
          Has Shown: ${state.hasShown ? 'Yes' : 'No'}<br>
          Time Required: ${config.minTimeOnPage / 1000}s<br>
          Scroll Required: ${config.minScrollDepth}%<br>
          Current Scroll: ${Math.round(state.scrollDepth)}%
        `);
      } else {
        alert('Load custom implementation first');
      }
    }
    
    function updateStatus(message) {
      document.getElementById('status').innerHTML = message;
    }
    
    function logResult(message) {
      const results = document.getElementById('test-results');
      const time = new Date().toLocaleTimeString();
      results.innerHTML += `<div>[${time}] ${message}</div>`;
    }
    
    // Listen for Tally events
    window.addEventListener('message', (e) => {
      if (e.data && e.data.event) {
        logResult('Tally event: ' + e.data.event);
      }
    });
    
    // Add some helpful console messages
    console.log('%cüß™ Exit Intent Test Page Ready', 'color: #007bff; font-size: 16px; font-weight: bold;');
    console.log('Choose an implementation above to begin testing');
  </script>
</body>
</html>